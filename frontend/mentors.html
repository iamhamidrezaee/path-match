<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="PathMatch connects Cornell CIS students with graduating seniors for personalized mentorship.">
    <meta name="theme-color" content="#B31B1B">
    <title>PathMatch — Mentors</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <nav class="nav" aria-label="Primary">
        <div class="nav-content">
            <a href="index.html" class="logo">PathMatch</a>
            <div class="nav-links">
                <a href="index.html#about">About</a>
                <a href="index.html" class="btn-secondary">Log Out</a>
            </div>
        </div>
    </nav>

    <!-- Welcome Banner for New Mentees -->
    <div class="app-container" id="welcome-section" style="display: none; padding-bottom: 0;">
        <div class="welcome-banner">
            <div>
                <h2>Welcome to PathMatch, <span id="mentee-name-display">Student</span>!</h2>
                <p>Your account is ready. Browse mentors below and schedule your first session.</p>
            </div>
            <button class="welcome-close" onclick="dismissWelcome()">&times;</button>
        </div>
    </div>

    <div class="app-page">
        <div class="app-container">
            <div class="page-header">
                <h1>Connect with Mentors</h1>
                <p>Browse our community of seniors ready to share their experience.</p>
            </div>

            <div class="mentors-grid" id="mentors-grid">
                <!-- Mentors will be populated here -->
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="availability-modal">
        <div class="modal">
            <button class="close-modal">&times;</button>
            <div id="modal-content">
                <div class="modal-mentor-header">
                    <div class="modal-mentor-avatar" id="modal-avatar">
                        <span id="modal-initials">AL</span>
                    </div>
                    <div class="modal-mentor-info">
                        <h2 id="modal-mentor-name">Andrew Lin</h2>
                        <span class="modal-mentor-role" id="modal-role">Software Engineering</span>
                    </div>
                </div>
                <p class="modal-mentor-bio" id="modal-bio">Experienced mentor ready to help with career guidance, technical interviews, and navigating the tech industry.</p>
                <p class="modal-section-title">Available Times</p>
                <p class="time-slots-hint">Select a time slot to book a session</p>
                <div class="time-slots" id="time-slots">
                    <div class="time-slot" data-slot="monday-14:00">
                        <span class="time-slot-day">Monday</span>
                        <span class="time-slot-time">2:00 PM - 2:30 PM</span>
                        <span class="time-slot-check">✓</span>
                    </div>
                    <div class="time-slot" data-slot="tuesday-16:00">
                        <span class="time-slot-day">Tuesday</span>
                        <span class="time-slot-time">4:00 PM - 4:30 PM</span>
                        <span class="time-slot-check">✓</span>
                    </div>
                    <div class="time-slot" data-slot="thursday-11:00">
                        <span class="time-slot-day">Thursday</span>
                        <span class="time-slot-time">11:00 AM - 11:30 AM</span>
                        <span class="time-slot-check">✓</span>
                    </div>
                </div>
                <button class="btn-primary confirm-booking-btn" id="confirm-booking-btn" disabled>Confirm Booking</button>
            </div>
            <div class="success-message" id="success-msg">
                <div class="success-icon">✓</div>
                <h3>Session Requested!</h3>
                <p>The mentor has been notified and will confirm your session shortly. Check your email for updates.</p>
                <button class="btn-primary" style="margin-top:1.5rem;" onclick="closeModal()">Done</button>
            </div>
        </div>
    </div>

    <script src="base.js"></script>
    <script>
        // Mentor data with bios
        const hardcodedMentors = [
            { 
                name: "Andrew Lin", 
                role: "Software Engineering", 
                tags: ["Tech", "Interview Prep"], 
                image: "Andrew.jpeg",
                bio: "Software engineer with experience at major tech companies. Passionate about helping students prepare for technical interviews and navigate the software industry."
            },
            { 
                name: "Anushka Singh", 
                role: "Product Management", 
                tags: ["PM", "Resume Review"], 
                image: "Anushka.jpeg",
                bio: "Product Manager focused on consumer tech. Happy to help with PM interview prep, resume reviews, and understanding the product development lifecycle."
            },
            { 
                name: "Chelsea Ho", 
                role: "UX Design", 
                tags: ["Design", "Portfolio"], 
                image: "Chelsea.jpeg",
                bio: "UX Designer with a passion for creating intuitive user experiences. Can help with portfolio reviews, design thinking, and breaking into the design field."
            },
            { 
                name: "Hamid Rezaee", 
                role: "Data Science", 
                tags: ["AI", "Research"], 
                image: "Hamid.jpeg",
                bio: "Data Scientist specializing in machine learning and AI research. Available to discuss PhD applications, research opportunities, and data science careers."
            },
            { 
                name: "Kamran Murray", 
                role: "Cybersecurity", 
                tags: ["Security", "Networking"], 
                image: "Kamran.jpeg",
                bio: "Cybersecurity professional with expertise in network security. Ready to help students explore security roles and certifications."
            },
            { 
                name: "Leina Mc Laughlin", 
                role: "Academia", 
                tags: ["PhD", "Research"], 
                image: "Leina.jpeg",
                bio: "Pursuing a PhD with focus on HCI research. Can advise on graduate school applications, academic research, and pursuing an academic career."
            },
            { 
                name: "Max Savona", 
                role: "Entrepreneurship", 
                tags: ["Startup", "Funding"], 
                image: "Max.jpeg",
                bio: "Startup founder with experience in fundraising and product development. Happy to discuss entrepreneurship, startup life, and business development."
            }
        ];

        const grid = document.getElementById('mentors-grid');
        const modal = document.getElementById('availability-modal');
        const modalContent = document.getElementById('modal-content');
        const successMsg = document.getElementById('success-msg');

        // Check for welcome state
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const isNewUser = urlParams.get('welcome') === 'true';
            const menteeName = urlParams.get('name') || localStorage.getItem('menteeName') || 'Student';
            
            if (isNewUser) {
                document.getElementById('welcome-section').style.display = 'block';
                document.getElementById('mentee-name-display').textContent = menteeName.split(' ')[0];
            } else {
                document.getElementById('mentors-header').classList.add('no-welcome');
            }
        });

        window.dismissWelcome = function() {
            document.getElementById('welcome-section').style.display = 'none';
            document.getElementById('mentors-header').classList.add('no-welcome');
        }

        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase();
        }

        function createMentorCard(mentor, score = null, quality = null) {
            const card = document.createElement('div');
            card.className = 'mentor-card';
            const initials = getInitials(mentor.name);
            const imgSrc = mentor.image ? `images/${mentor.image}` : '';
            
            // Compatibility badge HTML
            let badgeHtml = '';
            if (score !== null) {
                const qualityClass = quality ? quality.toLowerCase().replace(' match', '') : '';
                badgeHtml = `<div class="compatibility-badge ${qualityClass}"><span class="score">${Math.round(score)}%</span> match</div>`;
            }
            
            card.innerHTML = `
                <div class="mentor-image-container">
                    ${imgSrc ? 
                        `<img src="${imgSrc}" alt="${mentor.name}" class="mentor-image" onerror="this.outerHTML='<div class=\\'mentor-image-placeholder\\'>${initials}</div>'">` : 
                        `<div class="mentor-image-placeholder">${initials}</div>`
                    }
                    ${badgeHtml}
                </div>
                <div class="mentor-info">
                    <div class="mentor-name">${mentor.name}</div>
                    <div class="mentor-role">${mentor.role || 'Information Science Senior'}</div>
                    <p class="mentor-bio">${mentor.bio || 'Ready to help guide your academic and career journey.'}</p>
                    <div class="mentor-tags">
                        ${(mentor.tags || ['Mentorship']).map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                    <button class="btn-primary mentor-action" onclick='openModal(${JSON.stringify(mentor).replace(/'/g, "&#39;")})'>Connect</button>
                </div>
            `;
            return card;
        }

        async function loadMentors() {
            const API_BASE = 'http://localhost:5002';
            const menteeId = localStorage.getItem('menteeId');
            
            // If mentee is logged in, try to get personalized matches
            if (menteeId) {
                try {
                    const response = await fetch(`${API_BASE}/api/matches/find-for-mentee/${menteeId}`);
                    if (response.ok) {
                        const data = await response.json();
                        // Render matches with scores
                        data.matches.forEach(match => {
                            const mentor = match.mentor;
                            const firstName = mentor.name.split(' ')[0];
                            grid.appendChild(createMentorCard({
                                name: mentor.name,
                                role: mentor.career_pursuing || mentor.info_concentration,
                                tags: mentor.advising_topics ? JSON.parse(mentor.advising_topics) : ['Mentorship'],
                                image: `${firstName}.jpeg`,
                                bio: mentor.bio || 'Ready to help guide your academic and career journey.'
                            }, match.compatibility_score, match.quality));
                        });
                        return; // Success - don't load hardcoded
                    }
                } catch (e) {
                    console.log("Match API unavailable, falling back to standard view");
                }
            }
            
            // Fallback: Render hardcoded mentors (no scores)
            hardcodedMentors.forEach(m => grid.appendChild(createMentorCard(m)));

            // Try to fetch additional mentors from API
            try {
                const response = await fetch(`${API_BASE}/api/mentors`);
                if (response.ok) {
                    const data = await response.json();
                    data.mentors.forEach(m => {
                        if (!hardcodedMentors.some(hm => hm.name === m.name)) {
                            const firstName = m.name.split(' ')[0];
                            grid.appendChild(createMentorCard({
                                name: m.name,
                                role: m.career_pursuing || m.info_concentration,
                                tags: m.advising_topics ? JSON.parse(m.advising_topics) : ['Mentorship'],
                                image: `${firstName}.jpeg`,
                                bio: m.bio || 'Ready to help guide your academic and career journey.'
                            }));
                        }
                    });
                }
            } catch (e) {
                console.log("API unavailable, showing hardcoded mentors only");
            }
        }

        // Modal Logic
        let selectedTimeSlot = null;
        
        function resetModalState() {
            // Reset time slot selection
            selectedTimeSlot = null;
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            // Disable confirm button
            const confirmBtn = document.getElementById('confirm-booking-btn');
            if (confirmBtn) {
                confirmBtn.disabled = true;
            }
            // Reset visibility
            modalContent.style.display = 'block';
            successMsg.style.display = 'none';
        }
        
        window.openModal = function(mentorData) {
            // Handle both string (name) and object (full mentor data)
            let mentor;
            if (typeof mentorData === 'string') {
                mentor = hardcodedMentors.find(m => m.name === mentorData) || { name: mentorData, role: 'Mentor', bio: 'Ready to help guide your journey.' };
            } else {
                mentor = mentorData;
            }
            
            const initials = getInitials(mentor.name);
            
            document.getElementById('modal-mentor-name').textContent = mentor.name;
            document.getElementById('modal-role').textContent = mentor.role || mentor.career_pursuing || 'Mentor';
            document.getElementById('modal-bio').textContent = mentor.bio || 'Ready to help guide your academic and career journey.';
            document.getElementById('modal-initials').textContent = initials;
            
            // Set avatar image if available
            const avatarEl = document.getElementById('modal-avatar');
            const firstName = mentor.name.split(' ')[0];
            const imageSrc = mentor.image || `${firstName}.jpeg`;
            avatarEl.innerHTML = `<img src="images/${imageSrc}" alt="${mentor.name}" onerror="this.outerHTML='<span>${initials}</span>'">`;
            
            // Reset modal state before showing
            resetModalState();
            modal.style.display = 'flex';
        }

        window.closeModal = function() {
            modal.style.display = 'none';
            // Reset state when closing
            resetModalState();
        }

        document.querySelector('.close-modal').addEventListener('click', closeModal);
        
        // Time slot click handler - select/deselect
        document.getElementById('time-slots').addEventListener('click', (e) => {
            const clickedSlot = e.target.closest('.time-slot');
            if (clickedSlot) {
                // Remove selection from all slots
                document.querySelectorAll('.time-slot').forEach(slot => {
                    slot.classList.remove('selected');
                });
                
                // Select the clicked slot
                clickedSlot.classList.add('selected');
                selectedTimeSlot = clickedSlot.dataset.slot;
                
                // Enable confirm button
                document.getElementById('confirm-booking-btn').disabled = false;
            }
        });
        
        // Confirm booking button handler
        document.getElementById('confirm-booking-btn').addEventListener('click', () => {
            if (selectedTimeSlot) {
                modalContent.style.display = 'none';
                successMsg.style.display = 'block';
            }
        });
        
        // Close on outside click
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });

        // Escape key to close
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.style.display === 'flex') {
                closeModal();
            }
        });

        loadMentors();
    </script>
</body>
</html>

